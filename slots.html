<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Casino Slots</title>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .slot-machine {
      background: #1f1f1f;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 0 20px #00f0ff;
      text-align: center;
      width: 400px;
    }

    .reels {
      display: grid;
      grid-template-columns: repeat(3, 80px);
      grid-template-rows: repeat(3, 80px);
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .reel {
      background: #2a2a2a;
      border: 2px solid #555;
      border-radius: 8px;
      font-size: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.4s ease-in-out;
    }

    .spin {
      animation: spin 0.4s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotateX(0deg); }
      100% { transform: rotateX(360deg); }
    }

    input[type="number"] {
      padding: 10px;
      width: 120px;
      font-size: 1rem;
      margin-bottom: 15px;
      border-radius: 6px;
      border: none;
      text-align: center;
    }

    button {
      padding: 12px 28px;
      background: #00ffc3;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
    }

    .message {
      margin-top: 15px;
      font-size: 1rem;
      font-weight: bold;
    }

    .balance {
      margin-bottom: 10px;
      font-size: 1rem;
      color: #0f0;
    }

    .win-line {
      border-color: #0f0 !important;
      box-shadow: 0 0 10px #0f0;
    }
  </style>
</head>
<body>

<div class="slot-machine">
  <h2>Casino Slots</h2>
  <div class="balance" id="balance">Balance: $0.00</div>
  <input type="number" id="betAmount" min="0.1" max="10" step="0.1" placeholder="Bet Amount ($)">
  <div class="reels" id="reels">
    <div class="reel">?</div>
    <div class="reel">?</div>
    <div class="reel">?</div>
    <div class="reel">?</div>
    <div class="reel">?</div>
    <div class="reel">?</div>
    <div class="reel">?</div>
    <div class="reel">?</div>
    <div class="reel">?</div>
  </div>
  <button onclick="spin()">SPIN</button>
  <div class="message" id="message"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
  import { getDatabase, ref, onValue, set, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-f9f7e.appspot.com",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
    measurementId: "G-LLT6F9WRKH"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getDatabase();

  const balanceDisplay = document.getElementById("balance");
  const reels = document.querySelectorAll('.reel');
  const message = document.getElementById("message");

  let currentUser = null;
  let userBalance = 0;

  const symbols = [
    { emoji: 'ðŸ’', weight: 30, multiplier: 1.2 },
    { emoji: 'ðŸ‹', weight: 25, multiplier: 1.5 },
    { emoji: 'ðŸ””', weight: 20, multiplier: 2 },
    { emoji: 'â­', weight: 12, multiplier: 3 },
    { emoji: '7ï¸âƒ£', weight: 8, multiplier: 5 },
    { emoji: 'ðŸ’Ž', weight: 5, multiplier: 10 }
  ];

  const paylines = [
    [0, 1, 2],
    [3, 4, 5],
    [6, 7, 8],
    [0, 4, 8],
    [2, 4, 6]
  ];

  const totalWeight = symbols.reduce((sum, s) => sum + s.weight, 0);

  function weightedRandomSymbol() {
    let rand = Math.random() * totalWeight;
    for (const sym of symbols) {
      if (rand < sym.weight) return sym;
      rand -= sym.weight;
    }
    return symbols[0];
  }

  function generateBoard() {
    return Array(9).fill().map(() => weightedRandomSymbol());
  }

  function clearHighlights() {
    reels.forEach(r => r.classList.remove('win-line'));
  }

  function updateBalanceDisplay() {
    balanceDisplay.textContent = `Balance: $${userBalance.toFixed(2)}`;
  }

  async function spin() {
    const bet = parseFloat(document.getElementById('betAmount').value);
    if (!currentUser) return alert("You're not logged in!");
    if (isNaN(bet) || bet < 0.1 || bet > 10) {
      message.textContent = 'Enter a valid bet between $0.10 and $10';
      message.style.color = 'red';
      return;
    }
    if (bet > userBalance) {
      message.textContent = 'Insufficient balance!';
      message.style.color = 'red';
      return;
    }

    clearHighlights();
    reels.forEach(r => {
      r.classList.add('spin');
      r.textContent = '...';
    });
    message.textContent = '';

    setTimeout(() => {
      const board = generateBoard();
      board.forEach((s, i) => {
        reels[i].classList.remove('spin');
        reels[i].textContent = s.emoji;
      });

      const result = checkPaylines(board);
      if (result) {
        const { multiplier, line, symbol } = result;
        const winAmount = bet * multiplier;
        userBalance += (winAmount - bet);
        line.forEach(i => reels[i].classList.add('win-line'));
        message.textContent = `WIN! ${symbol} x3 â€” You won $${winAmount.toFixed(2)}`;
        message.style.color = '#00ff99';
      } else {
        userBalance -= bet;
        message.textContent = `You lost $${bet.toFixed(2)}`;
        message.style.color = '#ff4444';
      }

      update(ref(getDatabase(), "users/" + currentUser.uid + "/balance"), userBalance);
      updateBalanceDisplay();
    }, 1000);
  }

  function checkPaylines(board) {
    for (const line of paylines) {
      const [a, b, c] = line;
      if (board[a].emoji === board[b].emoji && board[b].emoji === board[c].emoji) {
        return {
          symbol: board[a].emoji,
          multiplier: board[a].multiplier,
          line: line
        };
      }
    }
    return null;
  }

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      currentUser = user;
      const balRef = ref(db, "users/" + user.uid + "/balance");
      const snap = await get(balRef);
      if (!snap.exists()) {
        await set(balRef, 3.00);
        userBalance = 3.00;
      } else {
        userBalance = parseFloat(snap.val());
      }
      updateBalanceDisplay();
    } else {
      alert("Not logged in â€” redirecting...");
      window.location.href = "login.html"; // change if needed
    }
  });
</script>

</body>
</html>