<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Users</title>
    <style>
        /* Basic styles for the app */
        body {
            font-family: Arial, sans-serif;
            background-color: #222;
            color: #fff;
            padding: 20px;
            margin: 0;
        }
        button {
            background-color: #00b3b3;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #009c9c;
        }
        .online-user {
            margin: 10px 0;
            padding: 10px;
            background-color: #333;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
        }
        #online-users-list {
            margin-top: 20px;
        }
        #status {
            margin-top: 10px;
            font-size: 18px;
        }
    </style>
</head>
<body>

    <h1>Welcome to the Online Game App</h1>
    <p id="status">Please log in to connect.</p>

    <!-- Connect Now Button -->
    <button id="connect-now-btn">Connect Now</button>

    <!-- Online Users List -->
    <div id="online-users-list">
        <h2>Online Users</h2>
        <!-- List of online users will appear here -->
    </div>

    <!-- Firebase SDK (Add your Firebase config here) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script>
        // Your Firebase Config (replace with your actual Firebase project config)
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-auth-domain",
            databaseURL: "your-database-url",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // UI Elements
        const connectNowButton = document.getElementById('connect-now-btn');
        const onlineUsersContainer = document.getElementById('online-users-list');
        const statusElement = document.getElementById('status');

        let currentUserId = null;

        // Listen for authentication state changes
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUserId = user.uid;
                statusElement.innerText = `Hello, ${user.displayName}!`;

                // Show the 'Connect Now' button only if the user is authenticated
                connectNowButton.style.display = 'block';

                // Fetch the list of online users
                fetchOnlineUsers();
            } else {
                statusElement.innerText = 'Please log in to connect.';
                connectNowButton.style.display = 'none';
            }
        });

        // Connect now button click handler
        connectNowButton.addEventListener('click', () => {
            if (currentUserId) {
                const userRef = db.ref(`users/${currentUserId}`);
                userRef.update({
                    online: true,
                    username: auth.currentUser.displayName
                });

                console.log('User marked as online.');
            } else {
                console.log('User is not logged in.');
            }
        });

        // Fetch online users and render them to the page
        function fetchOnlineUsers() {
            const usersRef = db.ref('users');
            usersRef.on('value', snapshot => {
                onlineUsersContainer.innerHTML = '<h2>Online Users</h2>'; // Clear previous list

                snapshot.forEach(childSnapshot => {
                    const userData = childSnapshot.val();
                    if (userData.online) {
                        const userDiv = document.createElement('div');
                        userDiv.classList.add('online-user');
                        userDiv.innerHTML = `
                            <span>${userData.username}</span>
                            <button onclick="connectUser('${childSnapshot.key}')">Connect</button>
                        `;
                        onlineUsersContainer.appendChild(userDiv);
                    }
                });
            });
        }

        // User connection logic (for example, opening a game session)
        function connectUser(userId) {
            console.log(`Connecting to user: ${userId}`);
            // Implement your game session or match logic here
        }

        // Mark user as offline when they leave or close the page
        function setUserOffline() {
            if (currentUserId) {
                const userRef = db.ref(`users/${currentUserId}`);
                userRef.update({ online: false });
                console.log('User marked as offline.');
            }
        }

        // Handle page close or refresh
        window.addEventListener('beforeunload', setUserOffline);

        // Handle Firebase Authentication (Sign-in & Sign-out)
        function signInWithEmailPassword(email, password) {
            auth.signInWithEmailAndPassword(email, password)
                .catch(error => console.error(error));
        }

        function signOutUser() {
            auth.signOut()
                .then(() => {
                    console.log('User signed out');
                    statusElement.innerText = 'Please log in to connect.';
                    connectNowButton.style.display = 'none';
                });
        }
    </script>
</body>
</html>