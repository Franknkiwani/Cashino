<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-f9f7e.appspot.com",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
    measurementId: "G-LLT6F9WRKH"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  const avatar = document.getElementById('avatarClick');
  const balanceText = document.getElementById('balance');
  const welcomeUser = document.getElementById('welcomeUser');
  const loadingOverlay = document.getElementById('loadingOverlay');
  const loadingText = document.getElementById('loadingText');

  onAuthStateChanged(auth, user => {
    if (user) {
      const uid = user.uid;

      get(ref(db, `users/${uid}/balance`)).then(snapshot => {
        const bal = snapshot.exists() ? snapshot.val() : 0;
        balanceText.textContent = `Balance: $${parseFloat(bal).toFixed(2)}`;
      }).catch(() => {
        balanceText.textContent = "Balance: $0.00";
      });

      get(ref(db, `users/${uid}/username`)).then(snapshot => {
        const name = snapshot.exists() ? snapshot.val() : "User";
        welcomeUser.textContent = `Welcome, ${name}`;
      }).catch(() => {
        welcomeUser.textContent = "Welcome, User";
      });

      if (user.photoURL) {
        avatar.src = user.photoURL;
      }

    } else {
      window.location.href = "index.html";
    }
  });

  function loadLeaderboard() {
    const leaderboardList = document.getElementById('leaderboardList');

    get(ref(db, 'users')).then(snapshot => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        const usersArray = Object.entries(data).map(([uid, userData]) => ({
          uid,
          username: userData.username || "Unknown",
          balance: parseFloat(userData.balance) || 0
        }));

        const topUsers = usersArray.sort((a, b) => b.balance - a.balance).slice(0, 3);
        leaderboardList.innerHTML = "";

        topUsers.forEach((user, index) => {
          const place = ["1st", "2nd", "3rd"][index];
          const item = document.createElement('div');
          item.style.background = '#111';
          item.style.border = '1px solid #00ffff88';
          item.style.borderRadius = '10px';
          item.style.padding = '10px';
          item.style.color = '#fff';
          item.style.boxShadow = '0 0 6px #00ffff22';

          item.innerHTML = `<strong>${place}</strong>: ${user.username} - $${user.balance.toFixed(2)}`;
          leaderboardList.appendChild(item);
        });

      } else {
        leaderboardList.innerHTML = "<div style='color: gray;'>No data found.</div>";
      }
    }).catch(error => {
      console.error("Error loading leaderboard:", error);
      leaderboardList.innerHTML = "<div style='color: red;'>Failed to load leaderboard.</div>";
    });
  }

  document.getElementById('logoutBtn').addEventListener('click', () => {
    loadingOverlay.classList.add('active');
    loadingText.textContent = 'Logging you out...';
    signOut(auth).then(() => {
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 1000);
    });
  });

  window.addEventListener('offline', () => {
    loadingOverlay.classList.add('active');
    loadingText.textContent = "You're offline!";
  });

  // Load leaderboard on page load
  loadLeaderboard();
</script>

<script>
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  const sidebarMsg = document.getElementById('sidebarMessage');
  const messages = ["You're awesome!", "Good to see you!", "Let's win big!", "Ready to roll?", "Feeling lucky?", "Have fun!", "Keep it up!"];
  const loadingMessages = ["Teleporting...", "Spinning the wheel...", "Loading your luck...", "Summoning servers...", "Just a sec...", "Getting things ready..."];

  document.getElementById('avatarClick').addEventListener('click', () => {
    sidebar.classList.add('active');
    overlay.classList.add('active');
    sidebarMsg.textContent = messages[Math.floor(Math.random() * messages.length)];
  });

  document.getElementById('closeSidebar').addEventListener('click', () => {
    sidebar.classList.remove('active');
    overlay.classList.remove('active');
  });

  overlay.addEventListener('click', () => {
    sidebar.classList.remove('active');
    overlay.classList.remove('active');
  });

  const navOptions = [
    { id: 'cashoutOption', url: 'cashout.html' },
    { id: 'depositOption', url: 'deposit.html' },
    { id: 'redeemOption', url: 'redeem.html' },
    { id: 'historyOption', url: 'history.html' },
    { id: 'contactOption', url: 'contact.html' },
    { id: 'privacyOption', url: 'privacy.html' }
  ];

  navOptions.forEach(opt => {
    document.getElementById(opt.id).addEventListener('click', () => {
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
      loadingOverlay.classList.add('active');
      loadingText.textContent = loadingMessages[Math.floor(Math.random() * loadingMessages.length)];
      setTimeout(() => window.location.href = opt.url, 1500);
    });
  });

  function updateClock() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    const s = String(now.getSeconds()).padStart(2, '0');
    document.getElementById('clock').textContent = `${h}.${m}.${s}`;
  }

  setInterval(updateClock, 1000);
  updateClock();
</script>